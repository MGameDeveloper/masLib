#include <stdint.h>
#include <stdlib.h>
#include <string.h>


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#define MAS_ECS_MEMORY_FRAME_SIZE (1024u * 16u)


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
typedef struct mas_ecs_memory
{
	uint8_t  frame[MAS_ECS_MEMORY_FRAME_SIZE];
	uint32_t frame_alloc_idx;
};


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
static mas_ecs_memory* g_memory = NULL;


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
bool  mas_ecs_memory_init()
{
	if (g_memory)
		return false;

	g_memory = (mas_ecs_memory*)malloc(sizeof(mas_ecs_memory));
	if (!g_memory)
		return false;
	memset(g_memory, 0, sizeof(mas_ecs_memory));

	return true;
}
void  mas_ecs_memory_deinit()
{
	if (g_memory)
	{
		free(g_memory);
		g_memory = NULL;
	}
}

void* mas_ecs_memory_frame_malloc(size_t size)
{
	if (!g_memory || (g_memory->frame_alloc_idx + size) > MAS_ECS_MEMORY_FRAME_SIZE)
		return NULL;

	void* data = &g_memory->frame[g_memory->frame_alloc_idx];
	g_memory->frame_alloc_idx += size;
	
	return data;
}

void mas_ecs_memory_frame_reset()
{
	if (!g_memory)
		return;

	memset(g_memory->frame, 0, MAS_ECS_MEMORY_FRAME_SIZE);
	g_memory->frame_alloc_idx = 0;
}